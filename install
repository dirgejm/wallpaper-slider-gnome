#!/bin/bash

if [ "$EUID" -ne 0 ]; then
    echo Error: wallpaper-slider requires root to install
    exit 1
fi

USER_HOME=$(getent passwd $SUDO_USER | cut -d: -f6)
# checks if files exist in home dir, if wallpaper-slider file is in usr/loca/bin
if [ -d $USER_HOME/wallpaper-slider-data ] && [ -f /usr/local/bin/wallpaper-slider ] && [ -f /usr/bin/wallpaper_slider.py ] && [ -f /etc/wallpaper-slider-gnome.txt ]; then
    echo
    echo wallpaper-slider installed with version $(<$USER_HOME/wallpaper-slider-data/data/version.txt)
else
    # first command is not executed by super user
    sudo -u $SUDO_USER cp -r wallpaper-slider-data $USER_HOME
    # requires sudo permissions, run 'sudo ./install'
    # path temporary
    echo "$USER_HOME" | cat > /etc/wallpaper-slider-gnome.txt
    cp wallpaper-slider /usr/local/bin
    chmod +x /usr/local/bin/wallpaper-slider
    chmod +rwx $USER_HOME/wallpaper-slider-data
    # placing in home directory instead
    # cp wallpaper_slider.py /usr/bin

    echo
    echo wallpaper-slider-gnome installed successfully!
    echo
    echo invoke with "'wallpaper-slider'" command...
fi

echo
echo steps to setup:
echo
echo enter "'wallpaper-slider -p'" and enter the path to your directory of wallpapers
echo
echo enter "'wallpaper-slider -d'" and enter your desired delay in the appropriate format
echo
echo enter "'sudo wallpaper-slider -r'" to set the script to run automatically on startup
echo
echo "finally enter 'wallpaper-slider -a' (make sure to run without SUDO, otherwise it will not work) to activate the program. Enjoy!"
echo